# Распознаваниие лиц на luckfox или как сдеать курсач по АСВТ за вечер
Тема курсовой работы: "Считыватель (Лицо + Глаза\Зрачки) для СКУД". 
Требуемый результат: система из двух камер, которые направлены перпендикулярно друг другу, чтобы можно было не только определять, есть ли лицо человека в базе, но и сколько людей находится в комнате. 
Это выжимка из инструкции с официального сайта luckfox, немнгочислленных на момент написания гайдов на ютубе и собственных наблюдений. 
# Знай врага в лицо
  Нужно понимать, что идти по пути рисовых инноваций - это перформанс по-настоящему сильного и бесстрашного человека, который не боится трудностей и недопонимания со стороны окружающих. Это путь человека, который развил глухоту к аргументам про удобство малинки, автоматически классифицируя их, как белый шум, который полностью отфильтровывается его мозгом. Это путь человека, который не будет тратить все свои накопления на курсач, так как он уже давно спустил все свои накопления. Это путь того, кому не надо что-либо кому-то доказывать, потому что он и сам знает, что он неимоверно крут, по крайней мере до тех пор, пока Раф снова не придумает какие-то доработки для работы и не внесет очередные правки.
## I выбор оборудования
  Так как Андрей Гыязович очень не любит, когда кто-то хочет сделать курсач на raspberry и подобный платах (там уже все давно придумано), он часто предлагает сделать курсовую на плате luckfox (Тут тоже все давно придумано, причем, самими разработчиками luckfox, но, видимо, он об этом еще не знает). Если вы берете ее - приготовьтесь к тому, что взаимодействовать с ней сложнее, чем с условной малинкой (по крайней мере, на первый взгляд), но, если вы решились взять luckfox - сначала надо выбрать какой. 
  В качестве камеры можно использовать какую-нибудь usb камеру или CSI камеру от того же luckfox (sc3336). Мы делали наш курсач именно на SCI, т.к. ее проще подключить к плате при условии ограниченности количества разъемов.
  В процессе работы я попробовал pico mini b, pico max и pico pro. На мой субъективный взгляд, самый универсальный вариант - luckfox pico max. У него, отличные характеристики, много пинов GPIO, он греется меньше своих младших братьев (pico pro и pico mini a/b), а также, система, соданная на его основе может быть очень дешевой. Но, в ночи перед сдачей, я успешно убил его, из-за чего мне срочно пришлось искать замену. В ту же ночь, было найдено единственное место в Москве, где можно купить схожую плату pico pro, что я и сделал в утро перед сдачей. Итоговый код работает на каждой из упомянутых плат, так что, можно было сдать и на mini. Есть еще ultra, но она дороже и ее фишки в этой работе абсолютно не нужны.
## II Операционнная система
  На сайте luckfox можно найти 2 операционные системы - buildroot и ubuntu. Конечно, хочется поставить родную ubuntu, но это не путь траера, т.к. ubuntu не поддерживает использование sci камеры. Придется кастрированный buildroot, но, для наших задач и этго хватит с головой.
  Ось легко ставится по инструкции с [официального сайта](https://wiki.luckfox.com/Luckfox-Pico-Pro-Max/Flash-image). Ее лучше ставить на карту памяти, т.к. код может не запуститься на голой плате, т.к. он занимает достаточно много места в оперативке.
## III Как тебя использовать?
  Теперь, после того, как вы поставили ОС на свою плату - можно наконец-то пощупать ее возможности. [Подключиться](https://wiki.luckfox.com/Luckfox-Pico-Pro-Max/Login) к ней можно по ssh или через adb tools. Также, можно посмотреть изображение с камеры в vlc. В основном, я общался с платой через ноут с линуксом через [adb](https://wiki.luckfox.com/Luckfox-Pico-Pro-Max/Login#22-adb-login-ubuntu2204) - это самый удобный вариант, на мой взгляд.
## IV Что дальше?
  Теперь у нас есть рабочая плата с рабочей осью, пора написать код. можно поиграться с [кросс-компилятором](https://wiki.luckfox.com/Luckfox-Pico-Pro-Max/Cross-Compile) и поделать всякие простые программы для запуска на плате. Но, вряд ли они смогут распознавать лица. 
  Можно попросить нейронку сгенерировать плюсовыый код для распознавания, что она с радостью сделает. Это, почти наверняка будет код, который использует библиотеку opencv, находит лица при помощи предобученной модели, например, каскада Хаара, возможно, даже сможет захватывать код с csi камеры, если вы укажете, по какому url можно к ней подключиться. Этот код будет рабочим, но, к сожалению, вы не сможете запустить его на плате, из-за массы причин, начиная от вычислительных мощностей платы, заканчивая тем, что на luckfox банально нет полноценной библиотеки opencv. К сожалению, придется взять готовый код с гитхаба производителей.
## V LuckfoxTECH
  Официальный репозиторий [LuckfoxTECH](https://github.com/LuckfoxTECH?ysclid=mj186664m9340422005) содержит много готовых решений для компьютерного зрения. Главное - по инструкции репозитория, можно легко собрать нужный код, дабы получилось запустить его на плате. Глобально, luckfox предоставляет 3 типа предобученных моделей:
  
  yolo - распознавание объектов. Со старта модель умеет распоззнавать около 80 классов объектов, в том числе, людей.
  
  retinaface - обнаружение лиц. Благодаря ней, можно быстро нходить лица в текущем кадре видео.
  
  facenet - распознавание лиц. Умеет выделять вектор численных значений лица по фото. Далее, эти вектора можно сравнивать, чтобы сравнивать разные лица.

  Этого вполне достаточно для выполнения задания. При помощи yolo на одной камере можно обнаруживать количество людей в кадре, а facenet может распознавать лица, найденные retinaface на второй плате. С yolo не должны возникнуть каких-либо серьезные проблемы, т.к. уже есть код, который определяет объекты в видео (в luckfoxTECH/luckfox_pico_rkmpi_example код luckfox_pico_rtsp_yolov5) и его надо лишь немного модифицировать, чтобы он обращал внимание только на людей и передавал сигнал о количестве (например, просто выводить 1 на какой-либо пин GPIO, коглда видно 1 человека и 0 в иных случаях). А вот с facenet придется повозиться. 
  
## I выбор платы
## I выбор платы
## I выбор платы
